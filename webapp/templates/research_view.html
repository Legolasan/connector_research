{% extends "base.html" %}

{% block content %}
<div class="flex min-h-screen">
    
    <!-- Sidebar - Table of Contents -->
    <aside class="w-72 bg-black/30 backdrop-blur-xl border-r border-white/5 flex flex-col fixed h-full overflow-hidden">
        <!-- Header -->
        <div class="p-6 border-b border-white/5">
            <a href="/" class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors mb-4">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                <span class="text-sm">Back to Dashboard</span>
            </a>
            
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-xl font-bold text-white">
                    {{ connector.name[:2].upper() }}
                </div>
                <div>
                    <h1 class="text-lg font-bold text-white">{{ connector.name }}</h1>
                    <span class="px-2 py-0.5 text-xs rounded-lg border"
                          style="{% if connector.status == 'complete' %}background: rgba(34, 197, 94, 0.2); color: #4ade80; border-color: rgba(34, 197, 94, 0.3);{% else %}background: rgba(156, 163, 175, 0.2); color: #9ca3af; border-color: rgba(156, 163, 175, 0.3);{% endif %}">
                        {{ connector.status }}
                    </span>
                </div>
            </div>
        </div>
        
        <!-- Table of Contents -->
        <div class="flex-1 overflow-y-auto p-4">
            <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Table of Contents</h3>
            <nav class="space-y-1">
                {% for item in toc_items %}
                <a href="#{{ item.anchor }}" 
                   class="block text-sm py-1.5 px-3 rounded-lg transition-colors
                          {% if item.level == 1 %}text-white font-medium hover:bg-white/10{% elif item.level == 2 %}text-gray-300 pl-6 hover:bg-white/5{% else %}text-gray-400 pl-9 text-xs hover:bg-white/5{% endif %}">
                    {{ item.title | truncate(35) }}
                </a>
                {% endfor %}
            </nav>
        </div>
        
        <!-- Actions -->
        <div class="p-4 border-t border-white/5 space-y-2">
            <a href="/api/connectors/{{ connector.id }}/download" 
               class="flex items-center justify-center gap-2 w-full px-4 py-2 bg-indigo-600 hover:bg-indigo-500 rounded-xl font-medium transition-colors text-sm">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                </svg>
                Download Markdown
            </a>
            <button onclick="window.print()" 
                    class="flex items-center justify-center gap-2 w-full px-4 py-2 bg-white/5 hover:bg-white/10 rounded-xl font-medium transition-colors text-sm text-gray-300">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                </svg>
                Print
            </button>
        </div>
    </aside>
    
    <!-- Main Content -->
    <main class="flex-1 ml-72">
        <article class="max-w-4xl mx-auto px-8 py-12">
            <!-- Research Content -->
            <div class="prose prose-invert prose-lg max-w-none research-content">
                {{ content | safe }}
            </div>
            
            <!-- Footer -->
            <div class="mt-16 pt-8 border-t border-white/10 text-center text-gray-500 text-sm">
                <p>Generated by Connector Research Platform</p>
                <p class="mt-1">Last updated: {{ connector.updated_at[:10] if connector.updated_at else 'N/A' }}</p>
            </div>
        </article>
    </main>
</div>

<style>
    /* Enhanced prose styling for research documents */
    .research-content h1 {
        font-size: 2.25rem;
        font-weight: 800;
        margin-top: 3rem;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid rgba(99, 102, 241, 0.3);
        color: #fff;
    }
    
    .research-content h1:first-child {
        margin-top: 0;
    }
    
    .research-content h2 {
        font-size: 1.5rem;
        font-weight: 700;
        margin-top: 2.5rem;
        margin-bottom: 1rem;
        color: #e0e7ff;
        scroll-margin-top: 2rem;
    }
    
    .research-content h3 {
        font-size: 1.25rem;
        font-weight: 600;
        margin-top: 2rem;
        margin-bottom: 0.75rem;
        color: #c7d2fe;
    }
    
    .research-content p {
        margin-top: 1rem;
        margin-bottom: 1rem;
        line-height: 1.8;
        color: #d1d5db;
    }
    
    .research-content ul, .research-content ol {
        margin-top: 1rem;
        margin-bottom: 1rem;
        padding-left: 1.5rem;
    }
    
    .research-content li {
        margin-top: 0.5rem;
        margin-bottom: 0.5rem;
        color: #d1d5db;
    }
    
    .research-content a {
        color: #818cf8;
        text-decoration: underline;
        text-underline-offset: 2px;
    }
    
    .research-content a:hover {
        color: #a5b4fc;
    }
    
    .research-content code {
        background: rgba(99, 102, 241, 0.15);
        color: #c7d2fe;
        padding: 0.2rem 0.4rem;
        border-radius: 0.375rem;
        font-size: 0.875em;
        font-family: 'JetBrains Mono', 'Fira Code', monospace;
    }
    
    .research-content pre {
        background: rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.75rem;
        padding: 1.25rem;
        overflow-x: auto;
        margin-top: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .research-content pre code {
        background: transparent;
        padding: 0;
        color: #e5e7eb;
    }
    
    .research-content table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1.5rem;
        margin-bottom: 1.5rem;
        font-size: 0.9rem;
    }
    
    .research-content thead {
        background: rgba(99, 102, 241, 0.15);
    }
    
    .research-content th {
        padding: 0.75rem 1rem;
        text-align: left;
        font-weight: 600;
        color: #e0e7ff;
        border-bottom: 2px solid rgba(99, 102, 241, 0.3);
    }
    
    .research-content td {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        color: #d1d5db;
    }
    
    .research-content tbody tr:hover {
        background: rgba(255, 255, 255, 0.02);
    }
    
    .research-content blockquote {
        border-left: 4px solid rgba(99, 102, 241, 0.5);
        padding-left: 1rem;
        margin-left: 0;
        margin-top: 1.5rem;
        margin-bottom: 1.5rem;
        color: #9ca3af;
        font-style: italic;
    }
    
    .research-content hr {
        border: none;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        margin: 2.5rem 0;
    }
    
    .research-content strong {
        color: #fff;
        font-weight: 600;
    }
    
    /* Smooth scrolling */
    html {
        scroll-behavior: smooth;
    }
    
    /* Print styles */
    @media print {
        aside {
            display: none !important;
        }
        main {
            margin-left: 0 !important;
        }
        .research-content {
            color: #000 !important;
        }
        .research-content h1, 
        .research-content h2, 
        .research-content h3,
        .research-content p,
        .research-content li,
        .research-content td {
            color: #000 !important;
        }
        body {
            background: #fff !important;
        }
    }
    
    /* Add IDs to headings for anchor links */
    .research-content h1,
    .research-content h2,
    .research-content h3 {
        position: relative;
    }
</style>

<script>
    // Add IDs to headings for anchor links
    document.addEventListener('DOMContentLoaded', function() {
        const headings = document.querySelectorAll('.research-content h1, .research-content h2, .research-content h3');
        headings.forEach(heading => {
            const text = heading.textContent;
            const id = text.toLowerCase()
                .replace(/[^\w\s-]/g, '')
                .replace(/[-\s]+/g, '-')
                .trim();
            heading.id = id;
        });
        
        // Highlight current section in TOC on scroll
        const tocLinks = document.querySelectorAll('aside nav a');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    tocLinks.forEach(link => {
                        link.classList.remove('bg-indigo-500/20', 'border-l-2', 'border-indigo-500');
                        if (link.getAttribute('href') === '#' + entry.target.id) {
                            link.classList.add('bg-indigo-500/20');
                        }
                    });
                }
            });
        }, { threshold: 0.5, rootMargin: '-100px 0px -50% 0px' });
        
        headings.forEach(heading => observer.observe(heading));
    });
</script>
{% endblock %}
